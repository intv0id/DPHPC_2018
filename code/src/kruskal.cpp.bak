#include <stdio.h>
#include <algorithm>
#include <map>
#include <cstdlib>

#include "kruskal.hpp"


using namespace std;


Kruskal::Kruskal(Graph G){
    // Convert graph type
    this -> n_vertices = G.n;
    for (auto n: G.nodes){
        for (auto e: n->adjacentEdges){
            struct edge new_edge = {
                    .source = n->index,
                    .target = e->source,
                    .weight = e->weight
            };

            this->edges.push_back(new_edge);
        }
    }
}


bool Kruskal::Compare(const edge &a, const edge &b){
    return a.weight > b.weight;
}

vector<edge> Kruskal::compute(){
    vector<edge> result;

    // Hashmap which links the index of a node to a pointer its tree
    // To merge trees we just need to change the pointer address
    map<int, tree **> nodeTrees;

    // Sort edges by weight
    sort(this->edges.begin(), this->edges.end(), this->Compare);

    // Create a tree for each node
    for(int i=0;i<this->n_vertices;i++){
        tree * new_tree = new tree();
        new_tree->id = i;
        nodeTrees[i] = & new_tree;
    }


    // Merge trees
    for (auto &e : this->edges){
        // Check if nodes doesn't belong to the same tree
        if(nodeTrees[e.source] !=  nodeTrees[e.target]){
            // Merge trees by changing pointer address
            nodeTrees[e.source] =  nodeTrees[e.target];
            // Get the edge in the resulting edges list
            result.push_back(e);
        }
    }

    return result;
}
